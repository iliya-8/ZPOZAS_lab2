# Лабораторная работа #2

# Разбор методик эксплуатации уязвимостей 

## 1. Список из 10 CVE-2022 - CVE-2025 (LPE|RCE)

5 RCE and 5 LPE

1) CVE-2024-38063    https://github.com/ynwarcs/CVE-2024-38063 (RCE)

2) CVE-2024-32002    https://github.com/amalmurali47/git_rce (RCE)

3) CVE-2024-21413    https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability (RCE)

4) CVE-2025-1097    https://github.com/hakaioffsec/IngressNightmare-PoC (RCE)

5) CVE-2025-24813    https://github.com/absholi7ly/POC-CVE-2025-24813 (RCE)

6) CVE-2024-1086    https://github.com/Notselwyn/CVE-2024-1086 (LPE)

7) CVE-2024-27518    https://github.com/secunnix/CVE-2024-27518 (LPE)

8) CVE-2022-34918    https://github.com/randorisec/CVE-2022-34918-LPE-PoC (LPE)

9) CVE-2022-21882    https://github.com/sailay1996/cve-2022-21882-poc (LPE)

10) CVE-2023-24871    https://github.com/ynwarcs/CVE-2023-24871/tree/main/lpe (LPE)

## 2. Разбор двух LPE и двух RCE

1) CVE-2024-38063    https://github.com/ynwarcs/CVE-2024-38063 (RCE)

- требования

pip3 install scapy

- использование

Изменение полей в скрипте:

iface <- Если у вас несколько адаптеров, вам нужно выбрать, какой из них использовать для отправки пакетов. Например, «eth0» в Linux или «Виртуальный Ethernet-адаптер Hyper-V» в Windows. Если вы собираетесь использовать интерфейс по умолчанию, оставьте поле пустым.

ip_addr <- IP-адрес целевой системы (IPv6)

num_tries & num_batches <- Сколько различных пакетов данных нужно отправить. Чем их больше, тем больше повреждений кучи и тем выше вероятность срабатывания уязвимости.

mac_addr <- Оставьте поле пустым, если только scapy не выдаст ошибку о том, что не может найти MAC-адрес. См. раздел «Устранение неполадок» ниже.

Запустить скрипт:

python3 cve-2024-38063.py

- Описание работы кода и пояснение к уязвимости:

В определённых ситуациях Windows объединяет несколько IP-пакетов и обрабатывает их в пакетном режиме. Сначала она обрабатывает заголовки расширений в каждом пакете, и только потом переходит к обработке данных в каждом пакете.

Во время обработки заголовка расширения объекты пакетов этих объединённых пакетов связываются в связанный список. Каждый объект пакета содержит NET_BUFFER объект, в котором хранятся буферизованные данные пакета. По смещению 0x30у нас также есть поле текущего смещения, которое указывает, насколько пакет был проанализирован. 

На этом этапе значение смещения обычно равно 0x28, что означает, что был проанализирован только заголовок IPv6.

При обработке заголовка расширения «параметры назначения» в tcpip!Ipv6pReceiveDestinationOptions возникает ошибка синтаксического анализа, которая приводит к вызову tcpip!IppSendErrorList . Эта функция вызывает tcpip!IppSendError для каждого объекта пакета в связанном списке (начиная с текущего).

При определённых условиях (например, если пакет является одноадресным) tcpip!IppSendError имеет побочные эффекты. Он «возвращает» буферизованные данные пакета к началу и сбрасывает поле текущего смещения до нуля.

Однако во всей этой цепочке событий только первый пакет помечен как содержащий ошибку (смещение 0x8C). Это означает, что драйвер будет продолжать анализировать дополнительные заголовки других пакетов в связанном списке, даже если они были «отменены» в IppSendError.

Обработка пакетов, которые были возвращены, выполняется с использованием неожиданных данных: данные буферизованного пакета указывают на начало пакета (то есть на заголовок IPv6), а не на дополнительные заголовки, и значение поля смещения равно нулю, а не 0x28.

2) 

- Подробные сведения:

Продукт: SUPERAntiSpyware Professional X и все его версии.

Затронутые версии: <= 10.0.1262 и последняя версия 10.0.1264

Идентификатор CVE: CVE-2024-27518

Операционная система: все поддерживаемые версии Windows, протестировано на Windows 10 Pro

Состояние: Публичное ответственное раскрытие информации.

Дата выхода: 03.04.2024

- Описание уязвимости:

SUPERAntiSpyware Professional X 10.0.1262 уязвим для локального повышения привилегий, поскольку позволяет непривилегированным пользователям восстанавливать вредоносную библиотеку DLL из карантина в папку "C:\Program Files\SUPERAntiSpyware" через соединение каталогов NTFS, как показано в примере с файлом version.dll, который распознаётся как вредоносное ПО. Поскольку SASCore64.exe содержит уязвимость DLL Hijacking для «version.dll», после перезагрузки системы можно получить оболочку NT AUTHORITY\SYSTEM.

- Технические подробности и пошаговое подтверждение концепции (PoC):

1 — создан вредоносный version.dll файл, содержащий шелл-код.
2 — если сгенерированный шелл-код, содержащий version.dll, ещё не обнаружен SUPERAntiSpyware, он объединяется с другим вредоносным файлом в ".zip" с помощью команды copy /b version_created.dll + malicious.zip version.dll для обнаружения как вредоносного. Таким образом, созданный файл ".dll" может быть обнаружен SUPERAntiSpyware как вредоносный и помещён в карантин.
3 — создайте новую папку и скопируйте в неё подготовленный version.dll. Затем папка будет просканирована, и SUPERAntiSpyware поместит DLL в карантин.
4 — при использовании CreateMountPoint.exe среди инструментов «Тестирования символических ссылок», предоставляемых Google, путь, по которому version.dll помещён в карантин, монтируется в каталог C:\Program Files\SUPERAntiSpyware. Эти инструменты доступны по следующей ссылке (https://github.com/googleprojectzero/symboliclink-testing-tools), или вы можете использовать команду mklink для выполнения той же задачи.
5 — после восстановления помещённой в карантин «version.dll» она будет скопирована в каталог SUPERAntiSpyware. После перезагрузки системы SASCore64.exe выполнит шелл-код в «version.dll» и откроет сеанс с NT AUTHORITY\SYSTEM привилегиями для злоумышленника.
